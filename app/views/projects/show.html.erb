<% unless notice == nil %><p class="success alert"><%= notice %></p><% end %>
<%= form_tag do %>
  <fieldset>
    <legend>Project <%= @project.title %></legend>
    <p>
      <strong>Title:</strong>
      <%= @project.title %>
    </p>

    <p>
      <strong>Description:</strong>
      <%= @project.description %>
    </p>
    

   </fieldset>
<% end %>

<%= form_tag do %>
  <fieldset>
    <legend>Developers</legend>
    <table>
      <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
      </tr>
      </thead>

      <tbody>
      <% @project.developers.each do |developer| %>
          <tr>
            <td><%= developer.name %></td>
            <td><%= developer.email %></td>
          </tr>
      <% end %>
      </tbody>
    </table>
  </fieldset>
<% end %>

<%= form_tag do %>
  <fieldset>
  	<legend>Story Board</legend>
  	<table>
  	  <thead>
   	 <tr>
   		  <th>Title</th>
  	    <th>Description</th>
   	 	  <th>Point</th>
   	 	  <th>Stages</th>
    	  <th colspan="4"></th>
   	 </tr>
  	 </thead>
  	
   	 <tbody>
   	 <% @project.stories.each do |story| %>
   	 <% if story.stages != 'Complete' %>
        <tr>
          <td><%= story.title %></td>
          <td><%= story.description %></td>
          <td><%= story.point %></td>
          <td><%= story.stages %></td>
          <td><%= link_to 'Show', story_path(story,:back => 'project') %></td>
          <% if session[:position] == ['Developer'] %>

              <% developer = Developer.find_by_id(session[:developer_id]) %>
              <% if developer.line_item.present?  %>
                  <% if developer.line_item.story == story %>
                      <td></td>
                  <% else %>
          	        <td><%= link_to 'Sign', line_items_path(:story_id => story, :developer_id => session[:developer_id]), method: :post %></td>
                  <% end %>
              <% else %>
                  <td><%= link_to 'Sign', line_items_path(:story_id => story, :developer_id => session[:developer_id]), method: :post %></td>
              <% end %>
                      <td><%= link_to 'Destroy', story, method: :delete, data: { confirm: 'Are you sure?' } %>
            </td>
              <td><%= link_to 'Change Stage', edit_story_path(story) %></td>
              <td>





              </td>
        </tr>
          <% end %>
     <% end %>
   	 <% end %>
   	 </tbody>
  	</table>
  </fieldset>

	<fieldset>
  	<legend>Total Points</legend>
		<table>
			<% stages = ['Analysis','Ready For Dev','In Dev','Dev Complete','In Test','Complete'] %>
  	 <thead>
   	 <tr>
   	 		<th>Stages</th>
  	    <% stages.each do |stage|%>
  	    	<th><%= stage %></th>
  	    <% end %>

   	 </tr>
  	 </thead>
  	 
  	 <tbody>
  	 		<tr>
  	 			<td><%= 'Points'%></td>
  	 			<% stages.each do |stage|%>
  	 				<td><%= @project.sum_point[stage] %></td>
  	 			<% end %>
  	 		</tr>
  	 </tbody>
		</table>
	</fieldset>
<% end %>

  <% if session[:position] == ['Developer'] %>
    <div class="medium btn pill-left default">
      <%= link_to 'New Story',new_story_path %> 
    </div>
    <div class="medium btn pill-right default">
    	<%= link_to 'Back', developer_path(session[:developer_id].to_s.to_sym) %>
    </div>
  <% elsif session[:position] == ['Admin'] %>
    <div class="medium oval btn default">
  	 <%= link_to 'Back', projects_path %>
    </div>
  <% end %>


